function lisa_prs_collect_ver4(cl_num_arm1,cl_num_arm2,flag_reverse_use);

% Assuming that arm2 is cl4. ;
% Generalizing to allow for flag_reverse. ;

%clear;
set(groot,'defaultFigureCreateFcn',@(fig,~)addToolbarExplorationButtons(fig));
set(groot,'defaultAxesCreateFcn',@(ax,~)set(ax.Toolbar,'Visible','off'));
addpath('/data/rangan/dir_bcc/dir_code_022316');
addpath('/data/rangan/dir_bcc/dir_PGC_20180304/dir_m');
dir_trunk = '/data/rangan/dir_bcc/dir_PGC_20180304';
dir_bip32 = '/data/rangan/dir_bcc/dir_BIP32_loo_data';

%cl_num_arm1 = 1; cl_num_arm2 = 4; flag_reverse_use = 1;
if nargin<1; cl_num_arm1 = 1; end;
if nargin<2; cl_num_arm2 = 4; end;
if nargin<3; flag_reverse_use = 0; end;
n_figure = 1;
%%%%%%%%;
verbose = 1;
B_MLT = 34; n_mds = 20; n_scramble = 1; n_shuffle = 64;
flag_dex_vs_lak = {'dex'};
if (strcmp(flag_dex_vs_lak{1},'dex')); gamma = 0.004; mc_string = ''; end; 
if (strcmp(flag_dex_vs_lak{1},'lak')); gamma = 0.001; mc_string = 'm20_p85'; end;
flag_reverse = flag_reverse_use;
cl_num = cl_num_arm1;
n_maf = 5; n_cov = 2;
%%%%%%%%;
lisa_setprefix_ver2 ;
lisa_setnames_ver2 ;
lisa_xdropextract_ver2 ;
lisa_loadmdsfambim_ver2 ;
lisa_mxcheck_ver2 ;
lisa_studyindex_ver2 ;
%%%%%%%%;
bim_arm1_ = bim_;
fam_arm1_ = fam_;
fam_name_arm1_ = fam_name_;
mds_sort_arm1_ = mds_sort_;
string_prefix_arm1 = string_prefix;
%string_name_arm1 = string_name;
string_name_r1_arm1 = string_name;
string_name_r0_arm1 = string_name_r0;
%dir_out_s0000_arm1 = dir_out_s0000;
dir_out_s0000_r1_arm1 = dir_out_s0000;
dir_out_s0000_r0_arm1 = dir_out_s0000_r0;
%dir_out_trace_arm1 = dir_out_trace;
dir_out_trace_r1_arm1 = dir_out_trace;
dir_out_trace_r0_arm1 = dir_out_trace_r0;
%%%%%%%%;
clear bim_ fam_ mds_sort_ mds_;
%%%%%%%%;
verbose = 1;
B_MLT = 34; n_mds = 20; n_scramble = 1; n_shuffle = 64;
flag_dex_vs_lak = {'dex'};
if (strcmp(flag_dex_vs_lak{1},'dex')); gamma = 0.004; mc_string = ''; end; 
if (strcmp(flag_dex_vs_lak{1},'lak')); gamma = 0.001; mc_string = 'm20_p85'; end;
flag_reverse = flag_reverse_use;
cl_num = cl_num_arm2;
n_maf = 5; n_cov = 2;
%%%%%%%%;
lisa_setprefix_ver2 ;
lisa_setnames_ver2 ;
lisa_xdropextract_ver2 ;
lisa_loadmdsfambim_ver2 ;
lisa_mxcheck_ver2 ;
lisa_studyindex_ver2 ;
%%%%%%%%;
bim_arm2_ = bim_;
fam_arm2_ = fam_;
fam_name_arm2_ = fam_name_;
mds_sort_arm2_ = mds_sort_;
string_prefix_arm2 = string_prefix;
%string_name_arm2 = string_name;
string_name_r1_arm2 = string_name;
string_name_r0_arm2 = string_name_r0;
%dir_out_s0000_arm2 = dir_out_s0000;
dir_out_s0000_r1_arm2 = dir_out_s0000;
dir_out_s0000_r0_arm2 = dir_out_s0000_r0;
%dir_out_trace_arm2 = dir_out_trace;
dir_out_trace_r1_arm2 = dir_out_trace;
dir_out_trace_r0_arm2 = dir_out_trace_r0;
%%%%%%%%;
clear bim_ fam_ mds_sort_ mds_;
%%%%%%%%;

%%%%%%%%%%%%%%%%;
% load prw weights for snps. ;
%%%%%%%%%%%%%%%%;
fname = sprintf('%s/dir_scores/%s',dir_bip32,'daner_PGC_BIP32b_mds7a.loo.no.icuk.gz.clumped.xmhc');
fid = fopen(fname);
prw_ = textscan(fid,'%d%s%d%s%s%f%f%f%f%f%f%d%s%f%f%f%f','headerlines',1);
fclose(fid);
n_prw = length(prw_{1});
%%%%%%%%;
ni=1;
prw_chr_ = prw_{ni}; ni=ni+1; % chromosome number ;
prw_snp_ = prw_{ni}; ni=ni+1; % marker id ; 
prw__bp_ = prw_{ni}; ni=ni+1; % physical distance ;
prw__a1_ = prw_{ni}; ni=ni+1; % allele 1 ;
prw__a2_ = prw_{ni}; ni=ni+1; % allele 2 ;
prw_fra_ = prw_{ni}; ni=ni+1; % frequency a ;
prw_fru_ = prw_{ni}; ni=ni+1; % frequency u ;
prw_inf_ = prw_{ni}; ni=ni+1; % info score ;
prw__or_ = prw_{ni}; ni=ni+1; % odds ratio ;
prw__se_ = prw_{ni}; ni=ni+1; % standard error ;
prw__pv_ = prw_{ni}; ni=ni+1; % p-value ;
prw_ngt_ = prw_{ni}; ni=ni+1; % number genotyped ;
%%%%%%%%;
prw_name_ = cell(n_prw,1);
for nprw=1:n_prw;
prw_name_{nprw} = sprintf('%d&%s&%d&s&%s',prw_chr_(nprw),prw_snp_{nprw},prw__bp_(nprw),prw__a1_{nprw},prw__a2_{nprw});
end;%for nprw=1:n_prw;
%%%%%%%%;
prw_t_ = [5e-8,1e-6,1e-4,1e-3,1e-2,5e-2,0.1,0.2,0.5,1.0];
n_prs = length(prw_t_);
prw_S_ = zeros(n_prw,n_prs);
for nprs=1:n_prs;
tmp_ = log(prw__or_);
tmp_ij_ = find(prw__pv_>prw_t_(nprs));
tmp_(tmp_ij_) = 0;
tmp_ = tmp_/norm(tmp_,'fro');
prw_S_(:,nprs) = tmp_;
end;%for nprs=1:n_prs;
%%%%%%%%;
flag_disp=0; 
if flag_disp;
figure(n_figure); clf; n_figure = n_figure+1;
imagesc(transpose(prw_S_)*prw_S_,[0,+1]); colormap(colormap_beach());
set(gca,'XTick',1:n_prs,'XTickLabel',prw_t_);
set(gca,'YTick',1:n_prs,'YTickLabel',prw_t_);
xlabel('threshold'); ylabel('threshold'); title('dot-product');
colorbar; axis square;
end;%if flag_disp;
%%%%%%%%;
n_bin = 101;
tmp_x_ =  0.1*linspace(-1,+1,n_bin); xl_ = [min(tmp_x_),max(tmp_x_)];
tmp_y_ = 10.0*linspace(-1,+1,n_bin); yl_ = [min(tmp_y_),max(tmp_y_)];
flag_disp=0;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure+1;
imagesc(log(1+hist2d_0(log(prw__or_),log(prw__pv_).*sign(log(prw__or_)),n_bin,n_bin,xl_,yl_)));
set(gca,'XTick',1:10:n_bin,'XTickLabel',tmp_x_(1:10:n_bin));
set(gca,'YTick',1:10:n_bin,'YTickLabel',tmp_y_(1:10:n_bin));
xlabel('log(OR)'); ylabel('log(Pvalue)*sign(log(OR))');
title('log(OR) vs log(Pvalue)')
colormap(colormap_beach());
end;%if flag_disp;
%%%%%%%%;
flag_disp=0;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure+1;
tmp_p_ = log(prw__or_);
tmp_s_ = linspace(min(tmp_p_),max(tmp_p_),1024);
subplot(1,1,1);cla;hold on;
plot(tmp_p_,log(prw__pv_).*sign(tmp_p_),'.')
plot(tmp_s_,- 50*tmp_s_ - 20000.*tmp_s_.^3,'k-','LineWidth',2);
hold off;
end;%if flag_disp;

%%%%%%%%%%%%%%%%;
% copy bim file. ;
%%%%%%%%%%%%%%%%;
n_snp = length(bim_arm2_{1});
%%%%%%%%;
ni=1;
bim_chr_arm2_ = bim_arm2_{ni}; ni=ni+1; % chromosome number;
bim_mid_arm2_ = bim_arm2_{ni}; ni=ni+1; % marker id ;
bim_gdi_arm2_ = bim_arm2_{ni}; ni=ni+1; % genetic distance ;
bim_pdi_arm2_ = bim_arm2_{ni}; ni=ni+1; % physical distance ;
bim_al1_arm2_ = bim_arm2_{ni}; ni=ni+1; % allele 1 ;
bim_al2_arm2_ = bim_arm2_{ni}; ni=ni+1; % allele 2 ;
bim_alt_arm2_ = bim_arm2_{ni}; ni=ni+1; % allele type ;
bim_ren_arm2_ = bim_arm2_{ni}; ni=ni+1; % relative entropy ;
bim_fal_arm2_ = bim_arm2_{ni}; ni=ni+1; % frequency of allele type ;
bim_fmi_arm2_ = bim_arm2_{ni}; ni=ni+1; % frequency of missing data ; 
bim_maf_arm2_ = bim_arm2_{ni}; ni=ni+1; % minor allele frequency ;
%%%%%%%%%%%%%%%%;
% Note intersection. ;
%%%%%%%%%%%%%%%%;
disp(sprintf(' %% intersection prw_snp_ and bim_arm2_{2} %d prw__bp_ and bim_arm2_{4} %d',[length(intersect(prw_snp_,bim_arm2_{2})),length(intersect(prw__bp_,bim_arm2_{4}))]));

%%%%%%%%%%%%%%%%;
% copy fam file. ;
%%%%%%%%%%%%%%%%;
ni=1;
fam_fam_arm2_ = fam_arm2_{ni}; ni=ni+1;
fam_iid_arm2_ = fam_arm2_{ni}; ni=ni+1;
fam_pat_arm2_ = fam_arm2_{ni}; ni=ni+1;
fam_mat_arm2_ = fam_arm2_{ni}; ni=ni+1;
fam_sex_arm2_ = fam_arm2_{ni}; ni=ni+1;
fam_phe_arm2_ = fam_arm2_{ni}; ni=ni+1;
fam_dir_arm2_ = fam_arm2_{ni}; ni=ni+1;

%%%%%%%%%%%%%%%%;
% extract mc;
%%%%%%%%%%%%%%%%;
if (flag_reverse_use==0);
fname = sprintf('%s/%s_mr_A_full.b16',dir__in,string_prefix); fcheck(fname);
mr_D_ = tutorial_binary_uncompress(fname)>0;
fname = sprintf('%s/%s_mr_Z_full.b16',dir__in,string_prefix); fcheck(fname);
mr_X_ = tutorial_binary_uncompress(fname)>0;
end;%if (flag_reverse_use==0);
if (flag_reverse_use==1);
fname = sprintf('%s/%s_mr_Z_full.b16',dir__in,string_prefix); fcheck(fname);
mr_D_ = tutorial_binary_uncompress(fname)>0;
fname = sprintf('%s/%s_mr_A_full.b16',dir__in,string_prefix); fcheck(fname);
mr_X_ = tutorial_binary_uncompress(fname)>0;
end;%if (flag_reverse_use==1);
%%%%%%%%%%%%%%%%;
if (flag_reverse_use==0);
disp(sprintf('mr_D error: %0.16f',norm(cast(mr_D_,'double')-cast(fam_phe_arm2_==2,'double'))));
disp(sprintf('mr_X error: %0.16f',norm(cast(mr_X_,'double')-cast(fam_phe_arm2_==1,'double'))));
end;%if (flag_reverse_use==0);
if (flag_reverse_use==1);
disp(sprintf('mr_D error: %0.16f',norm(cast(mr_D_,'double')-cast(fam_phe_arm2_==1,'double'))));
disp(sprintf('mr_X error: %0.16f',norm(cast(mr_X_,'double')-cast(fam_phe_arm2_==2,'double'))));
end;%if (flag_reverse_use==1);

%%%%%%%%%%%%%%%%;
% build libraries for cauc p-value ;
%%%%%%%%%%%%%%%%;
[cauc02_avg_,cauc02_min_] = p_cauc_0(mds_sort_arm2_(find(mr_X_),1: 2),mds_sort_arm2_(find(mr_D_),1: 2),zeros(sum(mr_X_),1),zeros(sum(mr_D_),1),1024*8);
[cauc06_avg_,cauc06_min_] = p_cauc_0(mds_sort_arm2_(find(mr_X_),1: 6),mds_sort_arm2_(find(mr_D_),1: 6),zeros(sum(mr_X_),1),zeros(sum(mr_D_),1),1024*8);
[cauc19_avg_,cauc19_min_] = p_cauc_0(mds_sort_arm2_(find(mr_X_),[1:6,19]),mds_sort_arm2_(find(mr_D_),[1:6,19]),zeros(sum(mr_X_),1),zeros(sum(mr_D_),1),1024*8);
[cauc20_avg_,cauc20_min_] = p_cauc_0(mds_sort_arm2_(find(mr_X_),1:20),mds_sort_arm2_(find(mr_D_),1:20),zeros(sum(mr_X_),1),zeros(sum(mr_D_),1),1024*8);

%%%%%%%%%%%%%%%%;
% load prs scores. ;
%%%%%%%%%%%%%%%%;
n_prs = 10;
prs_ = cell(n_prs,1); n_patient_prs_ = zeros(n_prs,1);
prs_fam_ = cell(n_prs,1);
prs_iid_ = cell(n_prs,1);
prs_cou_ = cell(n_prs,1);
prs_phe_ = cell(n_prs,1);
prs_sco_ = cell(n_prs,1);
prs__c1_ = cell(n_prs,1);
prs__c2_ = cell(n_prs,1);
prs__c3_ = cell(n_prs,1);
prs__c4_ = cell(n_prs,1);
prs__c5_ = cell(n_prs,1);
prs__c6_ = cell(n_prs,1);
prs_c19_ = cell(n_prs,1);
iprs_ = cell(n_prs,1);
auc00_prs_ = zeros(n_prs,1);
auc02_prs_ = zeros(n_prs,1);
auc06_prs_ = zeros(n_prs,1);
auc19_prs_ = zeros(n_prs,1);
auc20_prs_ = zeros(n_prs,1);
logp_auc00_prs_ = zeros(n_prs,1);
logp_auc02_prs_ = zeros(n_prs,1);
logp_auc06_prs_ = zeros(n_prs,1);
logp_auc19_prs_ = zeros(n_prs,1);
logp_auc20_prs_ = zeros(n_prs,1);
%%%%%%%%;
for nprs=1:n_prs;
%%%%%%%%;
fname = sprintf('%s/dir_scores/PGC_BIP32b_mds7a.loo.no.icuk.%d.target.S%d.sumprofile_cov',dir_bip32,nprs,nprs); fcheck(fname);
fid = fopen(fname);
prs_{nprs} = textscan(fid,'%s%s%d%d%f%f%f%f%f%f%f%f','headerlines',1);
fclose(fid);
n_patient_prs_(nprs) = length(prs_{nprs}{1}); 
prs_name_{nprs} = cell(n_patient_prs_(nprs),1); 
for np=1:n_patient_prs_(nprs); prs_name_{nprs}{np} = sprintf('%s%s%s',prs_{nprs}{1}{np},'&',prs_{nprs}{2}{np}); end;%for np=1:n_patient_prs_(nprs);
ni=1;
prs_fam_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs_iid_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs_cou_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs_phe_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs_sco_{nprs} = prs_{nprs}{ni}; ni=ni+1; if (flag_reverse_use==1); prs_sco_{nprs} = -prs_sco_{nprs}; end;
prs__c1_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs__c2_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs__c3_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs__c4_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs__c5_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs__c6_{nprs} = prs_{nprs}{ni}; ni=ni+1;
prs_c19_{nprs} = prs_{nprs}{ni}; ni=ni+1;
%%%%%%%%%%%%%%%%;
disp(sprintf(' %% nprs %d: %s: intersection %d',nprs,fname,length(intersect(prs_name_{nprs},fam_name_arm2_))));
%%%%%%%%%%%%%%%%;
[~,ifam_,iprs_{nprs}] = intersect(fam_name_arm2_,prs_name_{nprs},'stable'); if (length(ifam_)<n_patient_F); disp('Warning! fam_name_ not a subset of prs_name_{nprs}'); end; 
disp(sprintf('phe error: %0.16f',norm(cast(fam_phe_arm2_,'double')-cast(prs_phe_{nprs}(iprs_{nprs}),'double'))));
disp(sprintf(' c1 error: %0.16f',norm(mds_sort_arm2_(:, 1)-prs__c1_{nprs}(iprs_{nprs}))));
disp(sprintf(' c2 error: %0.16f',norm(mds_sort_arm2_(:, 2)-prs__c2_{nprs}(iprs_{nprs}))));
disp(sprintf(' c3 error: %0.16f',norm(mds_sort_arm2_(:, 3)-prs__c3_{nprs}(iprs_{nprs}))));
disp(sprintf(' c4 error: %0.16f',norm(mds_sort_arm2_(:, 4)-prs__c4_{nprs}(iprs_{nprs}))));
disp(sprintf(' c5 error: %0.16f',norm(mds_sort_arm2_(:, 5)-prs__c5_{nprs}(iprs_{nprs}))));
disp(sprintf(' c6 error: %0.16f',norm(mds_sort_arm2_(:, 6)-prs__c6_{nprs}(iprs_{nprs}))));
disp(sprintf('c19 error: %0.16f',norm(mds_sort_arm2_(:,19)-prs_c19_{nprs}(iprs_{nprs}))));
%%%%%%%%%%%%%%%%;
% calculate auc and p-value for prs;
%%%%%%%%%%%%%%%%;
auc00_prs_(nprs) = auc_0(prs_sco_{nprs}(iprs_{nprs}(find(mr_X_))),prs_sco_{nprs}(iprs_{nprs}(find(mr_D_))));
logp_auc00_prs_(nprs) = logp_auc_0(auc00_prs_(nprs),min(sum(mr_D_),sum(mr_X_)));
auc02_prs_(nprs) = cauc_0(prs_sco_{nprs}(iprs_{nprs}(find(mr_X_))),prs_sco_{nprs}(iprs_{nprs}(find(mr_D_))),mds_sort_arm2_(find(mr_X_),1: 2),mds_sort_arm2_(find(mr_D_),1: 2));
logp_auc02_prs_(nprs) = log(max(1,length(find(cauc02_avg_>auc02_prs_(nprs)))/length(cauc02_avg_)));
auc06_prs_(nprs) = cauc_0(prs_sco_{nprs}(iprs_{nprs}(find(mr_X_))),prs_sco_{nprs}(iprs_{nprs}(find(mr_D_))),mds_sort_arm2_(find(mr_X_),1: 6),mds_sort_arm2_(find(mr_D_),1: 6));
logp_auc06_prs_(nprs) = log(max(1,length(find(cauc06_avg_>auc06_prs_(nprs)))/length(cauc06_avg_)));
auc19_prs_(nprs) = cauc_0(prs_sco_{nprs}(iprs_{nprs}(find(mr_X_))),prs_sco_{nprs}(iprs_{nprs}(find(mr_D_))),mds_sort_arm2_(find(mr_X_),[1:6,19]),mds_sort_arm2_(find(mr_D_),[1:6,19]));
logp_auc19_prs_(nprs) = log(max(1,length(find(cauc19_avg_>auc19_prs_(nprs)))/length(cauc19_avg_)));
auc20_prs_(nprs) = cauc_0(prs_sco_{nprs}(iprs_{nprs}(find(mr_X_))),prs_sco_{nprs}(iprs_{nprs}(find(mr_D_))),mds_sort_arm2_(find(mr_X_),1:20),mds_sort_arm2_(find(mr_D_),1:20));
logp_auc20_prs_(nprs) = log(max(1,length(find(cauc20_avg_>auc20_prs_(nprs)))/length(cauc20_avg_)));
%%%%%%%%;
end;%for nprs=1:n_prs;

%%%%%%%%%%%%%%%%;
% calculate auc and p-value for arm2;
%%%%%%%%%%%%%%%%;
dir_out_s0000_pca_r0_arm1 = sprintf('%s/dir_pca',dir_out_s0000_r0_arm1);
dir_out_s0000_pca_r1_arm1 = sprintf('%s/dir_pca',dir_out_s0000_r1_arm1);
prs_min_ = zeros(n_prs,1); prs_max_ = zeros(n_prs,1);
for nprs=1:n_prs; prs_min_(nprs) = min(prs_sco_{nprs}); prs_max_(nprs) = max(prs_sco_{nprs}); end;%for nprs=1:n_prs;
tmp_x_ = find(mr_X_); tmp_d_ = find(mr_D_);
n_r0_t = 21; n_r1_t = 21;
if (flag_reverse_use==0);
if (cl_num_arm1==1); ni_r0_arm2_ = [350]; ni_r1_arm2_ = [100]; end;
if (cl_num_arm1==2); ni_r0_arm2_ = [350]; ni_r1_arm2_ = [350]; end;
if (cl_num_arm1==3); ni_r0_arm2_ = [400]; ni_r1_arm2_ = [425]; end;
if (cl_num_arm1==4); ni_r0_arm2_ = [275]; ni_r1_arm2_ = [275]; end;
end;%if (flag_reverse_use==0);
if (flag_reverse_use==1);
if (cl_num_arm1==1); ni_r0_arm2_ = [400]; ni_r1_arm2_ = [150]; end;
if (cl_num_arm1==2); ni_r0_arm2_ = [450]; ni_r1_arm2_ = [425]; end;
if (cl_num_arm1==3); ni_r0_arm2_ = [450]; ni_r1_arm2_ = [500]; end;
if (cl_num_arm1==4); ni_r0_arm2_ = [300]; ni_r1_arm2_ = [350]; end;
end;%if (flag_reverse_use==1);
auc19_prs_t_ = zeros(n_r0_t,n_r1_t,n_prs,length(ni_r0_arm2_),length(ni_r1_arm2_));
p_x_rem_ = zeros(n_r0_t,n_r1_t,length(ni_r0_arm2_),length(ni_r1_arm2_));
p_d_rem_ = zeros(n_r0_t,n_r1_t,length(ni_r0_arm2_),length(ni_r1_arm2_));
for nir0_arm2_ = 1:length(ni_r0_arm2_); 
ni_r0_arm2 = ni_r0_arm2_(nir0_arm2_);
fname = sprintf('%s/pca_ni%d_tst%d_k2_B44_V_arm2_.mda',dir_out_s0000_pca_r0_arm1,ni_r0_arm2,cl_num_arm2); fcheck(fname); V_r0_arm2_ = mda_read_r8(fname);
fname = sprintf('%s/pca_proj_arm2_ni%d_tst%d_k2_B44_AnV_.mda',dir_out_s0000_pca_r0_arm1,ni_r0_arm2,cl_num_arm2); fcheck(fname); DnV_r0_arm2_ = mda_read_r8(fname);
fname = sprintf('%s/pca_proj_arm2_ni%d_tst%d_k2_B44_ZnV_.mda',dir_out_s0000_pca_r0_arm1,ni_r0_arm2,cl_num_arm2); fcheck(fname); XnV_r0_arm2_ = mda_read_r8(fname);
tmp_mds_x_ = mds_sort_arm2_(tmp_x_,[1:6,19]); tmp_mds_d_ = mds_sort_arm2_(tmp_d_,[1:6,19]);
tmp_r0_auc19 = cauc_0(XnV_r0_arm2_(tmp_x_,1),DnV_r0_arm2_(tmp_d_,1),tmp_mds_x_,tmp_mds_d_);
if (tmp_r0_auc19<0.5); disp(sprintf(' %% flipping nir0_arm2_ %d',nir0_arm2_)); DnV_r0_arm2_ = -DnV_r0_arm2_; XnV_r0_arm2_ = -XnV_r0_arm2_; end;
%tmp_r0_min = prctile([DnV_r0_arm2_(tmp_d_,1);XnV_r0_arm2_(tmp_x_,1)], 0);
%tmp_r0_max = prctile([DnV_r0_arm2_(tmp_d_,1);XnV_r0_arm2_(tmp_x_,1)], 95);
tmp_r0_min = prctile(DnV_r0_arm2_(tmp_d_,1), 0);
tmp_r0_max = prctile(DnV_r0_arm2_(tmp_d_,1), 95);
tmp_r0_t_ = prctile(DnV_r0_arm2_(tmp_d_,1), linspace(0,100,n_r0_t) );
for nir1_arm2_ = 1:length(ni_r1_arm2_);
ni_r1_arm2 = ni_r1_arm2_(nir1_arm2_);
fname = sprintf('%s/pca_ni%d_tst%d_k2_B44_V_arm2_.mda',dir_out_s0000_pca_r1_arm1,ni_r1_arm2,cl_num_arm2); fcheck(fname); V_r1_arm2_ = mda_read_r8(fname);
fname = sprintf('%s/pca_proj_arm2_ni%d_tst%d_k2_B44_AnV_.mda',dir_out_s0000_pca_r1_arm1,ni_r1_arm2,cl_num_arm2); fcheck(fname); DnV_r1_arm2_ = mda_read_r8(fname);
fname = sprintf('%s/pca_proj_arm2_ni%d_tst%d_k2_B44_ZnV_.mda',dir_out_s0000_pca_r1_arm1,ni_r1_arm2,cl_num_arm2); fcheck(fname); XnV_r1_arm2_ = mda_read_r8(fname);
tmp_mds_x_ = mds_sort_arm2_(tmp_x_,[1:6,19]); tmp_mds_d_ = mds_sort_arm2_(tmp_d_,[1:6,19]);
tmp_r1_auc19 = cauc_0(XnV_r1_arm2_(tmp_x_,1),DnV_r1_arm2_(tmp_d_,1),tmp_mds_x_,tmp_mds_d_);
if(tmp_r1_auc19<0.5); disp(sprintf(' %% flipping nir1_arm2_ %d',nir1_arm2_)); DnV_r1_arm2_ = -DnV_r1_arm2_; XnV_r1_arm2_ = -XnV_r1_arm2_; end;
%tmp_r1_min = prctile([DnV_r1_arm2_(tmp_d_,1);XnV_r1_arm2_(tmp_x_,1)], 0);
%tmp_r1_max = prctile([DnV_r1_arm2_(tmp_d_,1);XnV_r1_arm2_(tmp_x_,1)], 95);
tmp_r1_min = prctile(DnV_r1_arm2_(tmp_d_,1), 0);
tmp_r1_max = prctile(DnV_r1_arm2_(tmp_d_,1), 95);
tmp_r1_t_ = prctile(DnV_r1_arm2_(tmp_d_,1), linspace(0,100,n_r1_t) );
%%%%%%%%;
for nr0_t=1:n_r0_t; for nr1_t=1:n_r1_t;
tmp_r0_t = tmp_r0_t_(nr0_t); tmp_r1_t = tmp_r1_t_(nr1_t); 
tmp_xt_ = find((XnV_r0_arm2_(tmp_x_,1)>=tmp_r0_t) & (XnV_r1_arm2_(tmp_x_,1)>=tmp_r1_t)); 
tmp_dt_ = find((DnV_r0_arm2_(tmp_d_,1)>=tmp_r0_t) & (DnV_r1_arm2_(tmp_d_,1)>=tmp_r1_t));
p_x_rem_(nr0_t,nr1_t,nir0_arm2_,nir1_arm2_) = length(tmp_xt_)/length(tmp_x_);
p_d_rem_(nr0_t,nr1_t,nir0_arm2_,nir1_arm2_) = length(tmp_dt_)/length(tmp_d_);
for nprs=1:n_prs;
tmp_prs_x_ = prs_sco_{nprs}(iprs_{nprs}(tmp_x_(tmp_xt_))); tmp_prs_d_ = prs_sco_{nprs}(iprs_{nprs}(tmp_d_(tmp_dt_)));
tmp_mds_x_ = mds_sort_arm2_(tmp_x_(tmp_xt_),[1:6,19]); tmp_mds_d_ = mds_sort_arm2_(tmp_d_(tmp_dt_),[1:6,19]);
if (length(tmp_xt_)==0 & length(tmp_dt_)==0); auc19_prs_t_(nr0_t,nr1_t,nprs,nir0_arm2_,nir1_arm2_) = 0.5; end;
if (length(tmp_xt_)==0 & length(tmp_dt_)> 0); auc19_prs_t_(nr0_t,nr1_t,nprs,nir0_arm2_,nir1_arm2_) = 1.0; end;
if (length(tmp_xt_)> 0 & length(tmp_dt_)==0); auc19_prs_t_(nr0_t,nr1_t,nprs,nir0_arm2_,nir1_arm2_) = 0.0; end;
if (length(tmp_xt_)> 0 & length(tmp_dt_)> 0); auc19_prs_t_(nr0_t,nr1_t,nprs,nir0_arm2_,nir1_arm2_) = cauc_0(tmp_prs_x_,tmp_prs_d_,tmp_mds_x_,tmp_mds_d_); end;
end;%for nprs=1:n_prs;
end;end;%for nr0_t=1:n_r0_t;for nr1_t=1:n_r1_t;
%%%%%%%%;
end;end;%for nir0_arm2_ = 1:length(ni_r0_arm2_); for nir1_arm2_ = 1:length(ni_r1_arm2_);
%%%%%%%%;
lp_auc00_ = zeros(n_r0_t,n_r1_t,n_prs,length(ni_r0_arm2_),length(ni_r1_arm2_));
for nir0_arm2_ = 1:length(ni_r0_arm2_); 
ni_r0_arm2 = ni_r0_arm2_(nir0_arm2_);
for nir1_arm2_ = 1:length(ni_r1_arm2_);
ni_r1_arm2 = ni_r1_arm2_(nir1_arm2_);
for nr0_t=1:n_r0_t; for nr1_t=1:n_r1_t;
tmp_r0_t = tmp_r0_t_(nr0_t); tmp_r1_t = tmp_r1_t_(nr1_t); 
for nprs=1:n_prs;
tmp_n = min(p_x_rem_(nr0_t,nr1_t,nir0_arm2_,nir1_arm2_)*length(tmp_x_),p_d_rem_(nr0_t,nr1_t,nir0_arm2_,nir1_arm2_)*length(tmp_d_));
tmp_a = auc19_prs_t_(nr0_t,nr1_t,nprs,nir0_arm2_,nir1_arm2_);
lp_auc00_(nr0_t,nr1_t,nprs,nir0_arm2_,nir1_arm2_) = logp_auc_0(tmp_a,tmp_n);
end;%for nprs=1:n_prs;
end;end;%for nr0_t=1:n_r0_t;for nr1_t=1:n_r1_t;
end;end;%for nir0_arm2_ = 1:length(ni_r0_arm2_); for nir1_arm2_ = 1:length(ni_r1_arm2_);
%%%%%%%%;

%%%%%%%%;
% plot output. ;
%%%%%%%%;
nprs_sub_ = [2,3,4,5,10]; n_tick = 11;
for nir0_arm2_ = 1:length(ni_r0_arm2_); 
ni_r0_arm2 = ni_r0_arm2_(nir0_arm2_);
for nir1_arm2_ = 1:length(ni_r1_arm2_);
ni_r1_arm2 = ni_r1_arm2_(nir1_arm2_);
flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure+1;
colormap(colormap_beach());
for nprs_sub=1:length(nprs_sub_);
nprs = nprs_sub_(nprs_sub);
subplot(3,length(nprs_sub_),nprs_sub + 0*length(nprs_sub_));
imagesc(squeeze(auc19_prs_t_(:,:,nprs,nir0_arm2_,nir1_arm2_)),[0.5,0.75]);
tmp_tick_r1_ = round(linspace(1,n_r1_t,n_tick)); xlabel('r1 threshold (p_rem)'); set(gca,'XTick',tmp_tick_r1_,'XTickLabel',0.01*round(100*p_d_rem_(1,tmp_tick_r1_,nir0_arm2_,nir1_arm2_)));
tmp_tick_r0_ = round(linspace(1,n_r0_t,n_tick)); ylabel('r0 threshold (p_rem)'); set(gca,'YTick',tmp_tick_r0_,'YTickLabel',0.01*round(100*p_d_rem_(tmp_tick_r0_,1,nir0_arm2_,nir1_arm2_)));
xtickangle(90);
title(sprintf('S%d cauc',nprs));
subplot(3,length(nprs_sub_),nprs_sub + 1*length(nprs_sub_));
imagesc(squeeze(p_d_rem_(:,:,nir0_arm2_,nir1_arm2_)),[0.0,1.0]);
tmp_tick_r1_ = round(linspace(1,n_r1_t,n_tick)); xlabel('r1 threshold (p_rem)'); set(gca,'XTick',tmp_tick_r1_,'XTickLabel',0.01*round(100*p_d_rem_(1,tmp_tick_r1_,nir0_arm2_,nir1_arm2_)));
tmp_tick_r0_ = round(linspace(1,n_r0_t,n_tick)); ylabel('r0 threshold (p_rem)'); set(gca,'YTick',tmp_tick_r0_,'YTickLabel',0.01*round(100*p_d_rem_(tmp_tick_r0_,1,nir0_arm2_,nir1_arm2_)));
xtickangle(90);
title(sprintf('S%d fraction remaining',nprs));
subplot(3,length(nprs_sub_),nprs_sub + 2*length(nprs_sub_));
imagesc(-(1/log(10))*squeeze(lp_auc00_(:,:,nprs,nir0_arm2_,nir1_arm2_)),[0,10]);
tmp_tick_r1_ = round(linspace(1,n_r1_t,n_tick)); xlabel('r1 threshold (p_rem)'); set(gca,'XTick',tmp_tick_r1_,'XTickLabel',0.01*round(100*p_d_rem_(1,tmp_tick_r1_,nir0_arm2_,nir1_arm2_)));
tmp_tick_r0_ = round(linspace(1,n_r0_t,n_tick)); ylabel('r0 threshold (p_rem)'); set(gca,'YTick',tmp_tick_r0_,'YTickLabel',0.01*round(100*p_d_rem_(tmp_tick_r0_,1,nir0_arm2_,nir1_arm2_)));
xtickangle(90);
title(sprintf('S%d approximate -log10(pvalue)',nprs));
end;%for nprs=1:n_prs;
set(gcf,'Position',1+[0,0,1024*2,1024]);
fname = sprintf('%s/prs_collect_ver4_trn%d_tst%d_ni%.3d_ni%.3d.jpg',dir_out_s0000_pca_r0_arm1,cl_num_arm1,cl_num_arm2,ni_r0_arm2,ni_r1_arm2);
print('-djpeg',fname);
disp(sprintf(' %% writing to %s',fname));
end;%if flag_disp;
end;end;%for nir0_arm2_ = 1:length(ni_r0_arm2_); for nir1_arm2_ = 1:length(ni_r1_arm2_);













