function label_new_ = label_pair_update_knn_0(data_,label_);
% assumes 2 labels. ;
% changes labels for every point which is closest to two elements of the opposite label. ;
n_member_lob = 3;
u_ = unique(label_); flag_split = (length(u_)==2); if (flag_split); flag_split = flag_split & length(find(label_==u_(1)))>n_member_lob; end; if (flag_split); flag_split = flag_split & length(find(label_==u_(2)))>n_member_lob; end;
if (~flag_split); disp(sprintf(' %% Warning! cannot split in label_pair_update_knn_0')); end;
A_ij_ = find(label_==u_(1));
B_ij_ = find(label_==u_(2));
AB_ij_ = knnsearch(data_(A_ij_,:),data_(B_ij_,:),'k',2);
AA_ij_ = knnsearch(data_(A_ij_,:),data_(A_ij_,:),'k',3);
BA_ij_ = knnsearch(data_(B_ij_,:),data_(A_ij_,:),'k',2);
BB_ij_ = knnsearch(data_(B_ij_,:),data_(B_ij_,:),'k',3);
label_new_ = label_;
for na=1:length(A_ij_);
data_A = data_(A_ij_(na),:);
data_BA1 = data_(B_ij_(BA_ij_(na,1)),:);
data_BA2 = data_(B_ij_(BA_ij_(na,2)),:);
data_AA1 = data_(A_ij_(AA_ij_(na,2)),:);
data_AA2 = data_(A_ij_(AA_ij_(na,3)),:);
d_BA1 = fnorm(data_A-data_BA1);
d_BA2 = fnorm(data_A-data_BA2);
d_AA1 = fnorm(data_A-data_AA1);
d_AA2 = fnorm(data_A-data_AA2);
%if (d_BA1<d_AA1); label_new_(A_ij_(na)) = u_(2); end;
if (max(d_BA1,d_BA2)<min(d_AA1,d_AA2)); label_new_(A_ij_(na)) = u_(2); end;
end;%for na=1:length(A_ij_);
for nb=1:length(B_ij_);
data_B = data_(B_ij_(nb),:);
data_AB1 = data_(A_ij_(AB_ij_(nb,1)),:);
data_AB2 = data_(A_ij_(AB_ij_(nb,2)),:);
data_BB1 = data_(B_ij_(BB_ij_(nb,2)),:);
data_BB2 = data_(B_ij_(BB_ij_(nb,3)),:);
d_AB1 = fnorm(data_B-data_AB1);
d_AB2 = fnorm(data_B-data_AB2);
d_BB1 = fnorm(data_B-data_BB1);
d_BB2 = fnorm(data_B-data_BB2);
%if (d_AB1<d_BB1); label_new_(B_ij_(nb)) = u_(1); end;
if (max(d_AB1,d_AB2)<min(d_BB1,d_BB2)); label_new_(B_ij_(nb)) = u_(1); end;
end;%for nb=1:length(B_ij_);
