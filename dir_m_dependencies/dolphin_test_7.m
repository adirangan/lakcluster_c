%%%%%%%%;
% tests SDE regression. ;
%%%%%%%%;

tolerance_master = 1e-6;
verbose=0;
flag_plot=0;
nf=0;

tolerance_master = 1e-6;
n_var = 2; T_max = 15;
if n_var==1; A_tru__ = -1*eye(n_var); end;
if n_var==2; A_tru__ = [-2/T_max , -1 ; +1 -3/T_max]; end;
a_tru_ = A_tru__*ones(n_var,1)*0.3;
A_inv_a_ = pinv(A_tru__,tolerance_master)*a_tru_;
disp(sprintf(' %% A_inv_a_: '));
if (verbose); disp(A_inv_a_); end;
if n_var==1; BB_tru__ = 1.5*eye(n_var); end;
if n_var==2;
B_inv__ = [ +1 , 0.1 ; -1 , 0.2]; BB_inv_tru__ = B_inv__*transpose(B_inv__);
BB_tru__ = pinv(BB_inv_tru__,tolerance_master);
end;%if n_var==2;
if n_var==1; CC_tru__ = 1*eye(n_var); end;
if n_var==2;
C_inv__ = [ +0.5 , +0.6 ; -0.7 , +0.9]; CC_inv_tru__ = C_inv__*transpose(C_inv__);
CC_tru__ = pinv(CC_inv_tru__,tolerance_master);
end;%if n_var==2;

aid_=[];
age_=[];
dat_X__=[];
dat_Y__=[];
n_aid = 9;
dt_avg = 0.125;
nsmp=0;
for naid=0:n_aid-1;
%%%%;
parameter = struct('type','parameter');
parameter.tolerance_master = tolerance_master;
parameter.dt_avg = dt_avg;
parameter.T_max = T_max;
parameter.rseed = naid;
[ ...
 parameter ...
,tmp_age_ ...
,tmp_X__ ...
,tmp_Y__ ...
] = ...
SDE_generate_data_0( ...
 parameter ...
,a_tru_ ...
,A_tru__ ...
,BB_tru__ ...
,BB_inv_tru__ ...
,CC_tru__ ...
,CC_inv_tru__ ...
);
%%%%;
tmp_n_T = numel(tmp_age_);
aid_(1+nsmp+[0:tmp_n_T-1],:) = naid;
age_(1+nsmp+[0:tmp_n_T-1],:) = tmp_age_;
dat_X__(1+nsmp+[0:tmp_n_T-1],:) = transpose(tmp_X__);
dat_Y__(1+nsmp+[0:tmp_n_T-1],:) = transpose(tmp_Y__);
nsmp=nsmp+tmp_n_T;
end;%for naid=0:n_aid-1;
n_smp = nsmp;
%%%%%%%%;
if flag_plot;
figure(1+nf);nf=nf+1;clf;figbig;figbeach();
p_row = n_aid; p_col = 4; ns=0;
for naid=0:n_aid-1;
tmp_index_ = efind(aid_==naid);
tmp_age_ = age_(1+tmp_index_);
tmp_dat_X__ = dat_X__(1+tmp_index_,:);
tmp_dat_Y__ = dat_Y__(1+tmp_index_,:);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
plot(tmp_age_,tmp_dat_X__(:,1),'r-',tmp_age_,tmp_dat_X__(:,2),'b-');
hold off; title(sprintf('naid %d X__',naid),'Interpreter','none');
xlabel('time');ylabel('X'); xlim([0,T_max]);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
s = surfline_0(tmp_dat_X__(:,1),tmp_dat_X__(:,2),tmp_age_); set(s,'LineWidth',3);
hold off; title(sprintf('naid %d X__',naid),'Interpreter','none');
xlabel('x0');ylabel('x1'); axis image;
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
plot(tmp_age_,tmp_dat_Y__(:,1),'r-',tmp_age_,tmp_dat_Y__(:,2),'b-');
hold off; title(sprintf('naid %d Y__',naid),'Interpreter','none');
xlabel('time');ylabel('Y'); xlim([0,T_max]);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
s = surfline_0(tmp_dat_Y__(:,1),tmp_dat_Y__(:,2),tmp_age_); set(s,'LineWidth',3);
hold off; title(sprintf('naid %d Y__',naid),'Interpreter','none');
xlabel('y0');ylabel('y1'); axis image;
end;%for naid=0:n_aid-1;
end;%if flag_plot;
%%%%;

%%%%%%%%;
% Now try kalman filtering. ;
%%%%%%%%;
[ ...
 parameter ...
,dat_X_fil__ ...
] = ...
dolphin_estimate_kalman_filter_0( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_X__ ...
,a_tru_ ...
,A_tru__ ...
,1*BB_inv_tru__ ...
,0*CC_inv_tru__ ...
);
%%%%;
[ ...
 parameter ...
,dat_Y_fil__ ...
] = ...
dolphin_estimate_kalman_filter_0( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_Y__ ...
,a_tru_ ...
,A_tru__ ...
,1*BB_inv_tru__ ...
,1*CC_inv_tru__ ...
);
%%%%%%%%;
if flag_plot;
figure(1+nf);nf=nf+1;clf;figbig;figbeach();
p_row = n_aid; p_col = 4; ns=0;
for naid=0:n_aid-1;
tmp_index_ = efind(aid_==naid);
tmp_age_ = age_(1+tmp_index_);
tmp_dat_X_fil__ = dat_X_fil__(1+tmp_index_,:);
tmp_dat_Y_fil__ = dat_Y_fil__(1+tmp_index_,:);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
plot(tmp_age_,tmp_dat_X_fil__(:,1),'r-',tmp_age_,tmp_dat_X_fil__(:,2),'b-');
hold off; title(sprintf('naid %d X_fil__',naid),'Interpreter','none');
xlabel('time');ylabel('X'); xlim([0,T_max]);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
s = surfline_0(tmp_dat_X_fil__(:,1),tmp_dat_X_fil__(:,2),tmp_age_); set(s,'LineWidth',3);
hold off; title(sprintf('naid %d X_fil__',naid),'Interpreter','none');
xlabel('x0');ylabel('x1'); axis image;
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
plot(tmp_age_,tmp_dat_Y_fil__(:,1),'r-',tmp_age_,tmp_dat_Y_fil__(:,2),'b-');
hold off; title(sprintf('naid %d Y_fil__',naid),'Interpreter','none');
xlabel('time');ylabel('Y'); xlim([0,T_max]);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
s = surfline_0(tmp_dat_Y_fil__(:,1),tmp_dat_Y_fil__(:,2),tmp_age_); set(s,'LineWidth',3);
hold off; title(sprintf('naid %d Y_fil__',naid),'Interpreter','none');
xlabel('y0');ylabel('y1'); axis image;
end;%for naid=0:n_aid-1;
end;%if flag_plot;
%%%%;

%%%%%%%%;
% Now estimate a_tru_ and A_tru__. ;
% Uses BB_inv_tru__ and CC_inv_tru__. ;
%%%%%%%%;
[ ...
 parameter ...
,a_X_est_ ...
,A_X_est__ ...
,L_X_est ...
] = ...
dolphin_estimate_aA_from_BC_3( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_X__ ...
,BB_inv_tru__ ...
,CC_inv_tru__ ...
);
disp(sprintf(' %% using X__: '));
disp(sprintf(' %% a_tru_ vs a_X_est_: %0.16f',fnorm(a_tru_ - a_X_est_)/fnorm(a_tru_)));
disp(sprintf(' %% A_tru__ vs A_X_est__: %0.16f',fnorm(A_tru__ - A_X_est__)/fnorm(A_tru__)));
disp(sprintf(' %% corr(A_tru__(:),A_X_est__(:)): %0.3f',corr(A_tru__(:),A_X_est__(:))));
%%%%;
[ ...
 parameter ...
,a_Y_est_ ...
,A_Y_est__ ...
,L_Y_est ...
] = ...
dolphin_estimate_aA_from_BC_3( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_Y__ ...
,BB_inv_tru__ ...
,CC_inv_tru__ ...
);
disp(sprintf(' %% using Y__: '));
disp(sprintf(' %% a_tru_ vs a_Y_est_: %0.16f',fnorm(a_tru_ - a_Y_est_)/fnorm(a_tru_)));
disp(sprintf(' %% A_tru__ vs A_Y_est__: %0.16f',fnorm(A_tru__ - A_Y_est__)/fnorm(A_tru__)));
disp(sprintf(' %% corr(A_tru__(:),A_Y_est__(:)): %0.3f',corr(A_tru__(:),A_Y_est__(:))));
%%%%;
[ ...
 parameter ...
,a_Y_fil_est_ ...
,A_Y_fil_est__ ...
,L_Y_fil_est ...
] = ...
dolphin_estimate_aA_from_BC_3( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_Y_fil__ ...
,BB_inv_tru__ ...
,CC_inv_tru__ ...
);
disp(sprintf(' %% using Y_fil__: '));
disp(sprintf(' %% a_tru_ vs a_Y_fil_est_: %0.16f',fnorm(a_tru_ - a_Y_fil_est_)/fnorm(a_tru_)));
disp(sprintf(' %% A_tru__ vs A_Y_fil_est__: %0.16f',fnorm(A_tru__ - A_Y_fil_est__)/fnorm(A_tru__)));
disp(sprintf(' %% corr(A_tru__(:),A_Y_fil_est__(:)): %0.3f',corr(A_tru__(:),A_Y_fil_est__(:))));

%%%%%%%%;
% Now estimate BB_inv_tru__ and CC_inv_tru__. ;
% Uses a_tru_ and A_tru__. ;
%%%%%%%%;
[ ...
 parameter ...
,BB_inv_X_est__ ...
,CC_inv_X_est__ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_X__ ...
,a_tru_ ...
,A_tru__ ...
);
disp(sprintf(' %% BB_inv_tru__ vs BB_inv_X_est__: %0.16f',fnorm(BB_inv_tru__ - BB_inv_X_est__)/fnorm(BB_inv_tru__)));
disp(sprintf(' %% corr(BB_inv_tru__(:),BB_inv_X_est__(:)): %0.3f',corr(BB_inv_tru__(:),BB_inv_X_est__(:))));
disp(sprintf(' %% CC_inv_tru__ vs CC_inv_X_est__: %0.16f',fnorm(CC_inv_tru__ - CC_inv_X_est__)/fnorm(CC_inv_tru__)));
disp(sprintf(' %% corr(CC_inv_tru__(:),CC_inv_X_est__(:)): %0.3f',corr(CC_inv_tru__(:),CC_inv_X_est__(:))));
%%%%;
[ ...
 parameter ...
,BB_inv_Y_est__ ...
,CC_inv_Y_est__ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_Y__ ...
,a_tru_ ...
,A_tru__ ...
);
disp(sprintf(' %% BB_inv_tru__ vs BB_inv_Y_est__: %0.16f',fnorm(BB_inv_tru__ - BB_inv_Y_est__)/fnorm(BB_inv_tru__)));
disp(sprintf(' %% corr(BB_inv_tru__(:),BB_inv_Y_est__(:)): %0.3f',corr(BB_inv_tru__(:),BB_inv_Y_est__(:))));
disp(sprintf(' %% CC_inv_tru__ vs CC_inv_Y_est__: %0.16f',fnorm(CC_inv_tru__ - CC_inv_Y_est__)/fnorm(CC_inv_tru__)));
disp(sprintf(' %% corr(CC_inv_tru__(:),CC_inv_Y_est__(:)): %0.3f',corr(CC_inv_tru__(:),CC_inv_Y_est__(:))));
%%%%;
%%%%%%%%;
% Now try with crude. ;
%%%%%%%%;
[ ...
 parameter ...
,BB_inv_X_est_crude__ ...
,CC_inv_X_est_crude__ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_crude_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_X__ ...
,a_tru_ ...
,A_tru__ ...
);
disp(sprintf(' %% BB_inv_tru__ vs BB_inv_X_est_crude__: %0.16f',fnorm(BB_inv_tru__ - BB_inv_X_est_crude__)/fnorm(BB_inv_tru__)));
disp(sprintf(' %% corr(BB_inv_tru__(:),BB_inv_X_est_crude__(:)): %0.3f',corr(BB_inv_tru__(:),BB_inv_X_est_crude__(:))));
disp(sprintf(' %% CC_inv_tru__ vs CC_inv_X_est_crude__: %0.16f',fnorm(CC_inv_tru__ - CC_inv_X_est_crude__)/fnorm(CC_inv_tru__)));
disp(sprintf(' %% corr(CC_inv_tru__(:),CC_inv_X_est_crude__(:)): %0.3f',corr(CC_inv_tru__(:),CC_inv_X_est_crude__(:))));
%%%%;
[ ...
 parameter ...
,BB_inv_Y_est_crude__ ...
,CC_inv_Y_est_crude__ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_crude_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_Y__ ...
,a_tru_ ...
,A_tru__ ...
);
disp(sprintf(' %% BB_inv_tru__ vs BB_inv_Y_est_crude__: %0.16f',fnorm(BB_inv_tru__ - BB_inv_Y_est_crude__)/fnorm(BB_inv_tru__)));
disp(sprintf(' %% corr(BB_inv_tru__(:),BB_inv_Y_est_crude__(:)): %0.3f',corr(BB_inv_tru__(:),BB_inv_Y_est_crude__(:))));
disp(sprintf(' %% CC_inv_tru__ vs CC_inv_Y_est_crude__: %0.16f',fnorm(CC_inv_tru__ - CC_inv_Y_est_crude__)/fnorm(CC_inv_tru__)));
disp(sprintf(' %% corr(CC_inv_tru__(:),CC_inv_Y_est_crude__(:)): %0.3f',corr(CC_inv_tru__(:),CC_inv_Y_est_crude__(:))));
%%%%%%%%;
% Verdict: appears that crude is worse. ;
%%%%%%%%;


dat__ = dat_Y__;
%%%%%%%%;
% Initialize a and A. ;
%%%%%%%%;
a_ = zeros(n_var,1);
A__ = zeros(n_var,n_var); 
%%%%%%%%;
index_mss_ = efind(~isfinite(dat_Y__));
BB_inv__ = []; CC_inv__ = [];
%%%%%%%%;
% Now impute data using A. ;
%%%%%%%%;
dat_imp__ = dolphin_impute_aA_0(aid_,age_,dat__,a_,A__,index_mss_);
%%%%%%%%;
% Now estimate initial B,C. ;
%%%%%%%%;
[ ...
 parameter ...
,BB_inv__ ...
,CC_inv__ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_imp__ ...
,a_ ...
,A__ ...
);
%%%%%%%%;
% Now estimate a_ and A__ using unfiltered data. ;
%%%%%%%%;
[ ...
 parameter ...
,a_ ...
,A__ ...
,L ...
] = ...
dolphin_estimate_aA_from_BC_3( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_imp__ ...
,1*BB_inv__ ...
,1*CC_inv__ ...
);
disp(sprintf(' %% A__: %+0.2f %+0.2f %+0.2f %+0.2f',A__));
disp(sprintf(' %% corr(A_tru__(:),A__(:)): %0.3f',corr(A_tru__(:),A__(:))));
%%%%%%%%;
% Filter. ;
%%%%%%%%;
[ ...
 parameter ...
,dat_imp_fil__ ...
,P_pos_nvv___ ...
] = ...
dolphin_estimate_kalman_filter_0( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_imp__ ...
,a_ ...
,A__ ...
,1*BB_inv__ ...
,1*CC_inv__ ...
);
%%%%%%%%;
% Estimate modified B,C using filtered data. ;
%%%%%%%%;
[ ...
 parameter ...
,BB_inv_fil__ ...
,CC_inv_fil__ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_imp_fil__ ...
,a_ ...
,A__ ...
);
%%%%%%%%;
% Now estimate a_ and A__ using filtered data and modified B,C. ;
%%%%%%%%;
[ ...
 parameter ...
,a_ ...
,A__ ...
,L ...
] = ...
dolphin_estimate_aA_from_BC_3( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_imp_fil__ ...
,1*BB_inv_fil__ ...
,1*CC_inv_fil__ ...
);
disp(sprintf(' %% A__: %+0.2f %+0.2f %+0.2f %+0.2f',A__));
disp(sprintf(' %% corr(A_tru__(:),A__(:)): %0.3f',corr(A_tru__(:),A__(:))));
%%%%%%%%;
% Estimate B,C using unfiltered data. ;
%%%%%%%%;
[ ...
parameter ...
,BB_inv__ ...
,CC_inv__ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_imp__ ...
,a_ ...
,A__ ...
);
disp(sprintf(' %% BB_inv__: %+0.2f %+0.2f %+0.2f %+0.2f',BB_inv__));
disp(sprintf(' %% corr(BB_inv_tru__(:),BB_inv__(:)): %0.3f',corr(BB_inv_tru__(:),BB_inv__(:))));
disp(sprintf(' %% CC_inv__: %+0.2f %+0.2f %+0.2f %+0.2f',CC_inv__));
disp(sprintf(' %% corr(CC_inv_tru__(:),CC_inv__(:)): %0.3f',corr(CC_inv_tru__(:),CC_inv__(:))));
%%%%%%%%;
% Now estimate B using filtered data. ;
%%%%%%%%;
[ ...
 parameter ...
,BB_inv__ ...
,~ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_imp_fil__ ...
,a_ ...
,A__ ...
);
disp(sprintf(' %% BB_inv__: %+0.2f %+0.2f %+0.2f %+0.2f',BB_inv__));
disp(sprintf(' %% corr(BB_inv_tru__(:),BB_inv__(:)): %0.3f',corr(BB_inv_tru__(:),BB_inv__(:))));
%%%%%%%%;
% Now estimate C using unfiltered data. ;
%%%%%%%%;
[ ...
parameter ...
,~ ...
,CC_inv__ ...
] = ....
dolphin_estimate_BB_inv_CC_inv_from_aA_2( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_imp__ ...
,a_ ...
,A__ ...
);
disp(sprintf(' %% CC_inv__: %+0.2f %+0.2f %+0.2f %+0.2f',CC_inv__));
disp(sprintf(' %% corr(CC_inv_tru__(:),CC_inv__(:)): %0.3f',corr(CC_inv_tru__(:),CC_inv__(:))));
%%%%%%%%;
if flag_plot;
figure(1+nf);nf=nf+1;clf;figbig;figbeach();
p_row = n_aid; p_col = 4; ns=0;
for naid=0:n_aid-1;
tmp_index_ = efind(aid_==naid);
tmp_age_ = age_(1+tmp_index_);
tmp_dat_imp__ = dat_imp__(1+tmp_index_,:);
tmp_dat_imp_fil__ = dat_imp_fil__(1+tmp_index_,:);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
plot(tmp_age_,tmp_dat_imp__(:,1),'r-',tmp_age_,tmp_dat_imp__(:,2),'b-');
hold off; title(sprintf('naid %d Y_imp__',naid),'Interpreter','none');
xlabel('time');ylabel('Y'); xlim([0,T_max]);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
s = surfline_0(tmp_dat_imp__(:,1),tmp_dat_imp__(:,2),tmp_age_); set(s,'LineWidth',3);
hold off; title(sprintf('naid %d Y_imp__',naid),'Interpreter','none');
xlabel('y0');ylabel('y1'); axis image;
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
plot(tmp_age_,tmp_dat_imp_fil__(:,1),'r-',tmp_age_,tmp_dat_imp_fil__(:,2),'b-');
hold off; title(sprintf('naid %d Y_imp_fil__',naid),'Interpreter','none');
xlabel('time');ylabel('Y'); xlim([0,T_max]);
subplot(p_row,p_col,1+ns);ns=ns+1;
hold on;
s = surfline_0(tmp_dat_imp_fil__(:,1),tmp_dat_imp_fil__(:,2),tmp_age_); set(s,'LineWidth',3);
hold off; title(sprintf('naid %d Y_imp_fil__',naid),'Interpreter','none');
xlabel('y0');ylabel('y1'); axis image;
end;%for naid=0:n_aid-1;
end;%if flag_plot;
%%%%%%%%;

%%%%%%%%;
% Now try full reconstruction. ;
%%%%%%%%;
parameter.verbose = 0;
parameter.flag_filter = 0;
parameter.n_step = 1;
parameter.n_iteration = 32;
[ ...
 parameter ...
,a_rec_ ...
,A_rec__ ...
,BB_inv_rec__ ...
,CC_inv_rec__ ...
,L_rec ...
,niteration ...
,a_rec__ ...
,A_rec___ ...
,BB_inv_rec___ ...
,CC_inv_rec___ ...
,L_rec_ ...
,index_min ...
] = ...
dolphin_estimate_aABC_4( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_Y__ ...
);
disp(sprintf(' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%; '));
disp(sprintf(' %% flag_filter = %d; ',parameter.flag_filter));
disp(sprintf(' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%; '));
disp(sprintf(' %% a_rec_: %+0.2f %+0.2f',a_rec_));
disp(sprintf(' %% a_tru_ vs a_rec_: %0.6f',fnorm(a_tru_-a_rec_)/fnorm(a_tru_)));
disp(sprintf(' %% corr(a_tru_(:),a_rec_(:)): %0.3f',corr(a_tru_(:),a_rec_(:))));
disp(sprintf(' %% A_rec__: %+0.2f %+0.2f %+0.2f %+0.2f',A_rec__));
disp(sprintf(' %% A_tru__ vs A_rec__: %0.6f',fnorm(A_tru__-A_rec__)/fnorm(A_tru__)));
disp(sprintf(' %% corr(A_tru__(:),A_rec__(:)): %0.3f',corr(A_tru__(:),A_rec__(:))));
disp(sprintf(' %% BB_inv_rec__: %+0.2f %+0.2f %+0.2f %+0.2f',BB_inv_rec__));
disp(sprintf(' %% BB_inv_tru__ vs BB_inv_rec__: %0.6f',fnorm(BB_inv_tru__-BB_inv_rec__)/fnorm(BB_inv_tru__)));
disp(sprintf(' %% corr(BB_inv_tru__(:),BB_inv_rec__(:)): %0.3f',corr(BB_inv_tru__(:),BB_inv_rec__(:))));
disp(sprintf(' %% CC_inv_rec__: %+0.2f %+0.2f %+0.2f %+0.2f',CC_inv_rec__));
disp(sprintf(' %% CC_inv_tru__ vs CC_inv_rec__: %0.6f',fnorm(CC_inv_tru__-CC_inv_rec__)/fnorm(CC_inv_tru__)));
disp(sprintf(' %% corr(CC_inv_tru__(:),CC_inv_rec__(:)): %0.3f',corr(CC_inv_tru__(:),CC_inv_rec__(:))));

%%%%%%%%;
% Now try full reconstruction. ;
%%%%%%%%;
parameter.verbose = 0;
parameter.flag_filter = 1;
parameter.n_step = 1;
parameter.n_iteration = 32;
[ ...
 parameter ...
,a_rec_ ...
,A_rec__ ...
,BB_inv_rec__ ...
,CC_inv_rec__ ...
,L_rec ...
,niteration ...
,a_rec__ ...
,A_rec___ ...
,BB_inv_rec___ ...
,CC_inv_rec___ ...
,L_rec_ ...
,index_min ...
] = ...
dolphin_estimate_aABC_4( ...
 parameter ...
,aid_ ...
,age_ ...
,dat_Y__ ...
);
disp(sprintf(' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%; '));
disp(sprintf(' %% flag_filter = %d; ',parameter.flag_filter));
disp(sprintf(' %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%; '));
disp(sprintf(' %% a_rec_: %+0.2f %+0.2f',a_rec_));
disp(sprintf(' %% a_tru_ vs a_rec_: %0.6f',fnorm(a_tru_-a_rec_)/fnorm(a_tru_)));
disp(sprintf(' %% corr(a_tru_(:),a_rec_(:)): %0.3f',corr(a_tru_(:),a_rec_(:))));
disp(sprintf(' %% A_rec__: %+0.2f %+0.2f %+0.2f %+0.2f',A_rec__));
disp(sprintf(' %% A_tru__ vs A_rec__: %0.6f',fnorm(A_tru__-A_rec__)/fnorm(A_tru__)));
disp(sprintf(' %% corr(A_tru__(:),A_rec__(:)): %0.3f',corr(A_tru__(:),A_rec__(:))));
disp(sprintf(' %% BB_inv_rec__: %+0.2f %+0.2f %+0.2f %+0.2f',BB_inv_rec__));
disp(sprintf(' %% BB_inv_tru__ vs BB_inv_rec__: %0.6f',fnorm(BB_inv_tru__-BB_inv_rec__)/fnorm(BB_inv_tru__)));
disp(sprintf(' %% corr(BB_inv_tru__(:),BB_inv_rec__(:)): %0.3f',corr(BB_inv_tru__(:),BB_inv_rec__(:))));
disp(sprintf(' %% CC_inv_rec__: %+0.2f %+0.2f %+0.2f %+0.2f',CC_inv_rec__));
disp(sprintf(' %% CC_inv_tru__ vs CC_inv_rec__: %0.6f',fnorm(CC_inv_tru__-CC_inv_rec__)/fnorm(CC_inv_tru__)));
disp(sprintf(' %% corr(CC_inv_tru__(:),CC_inv_rec__(:)): %0.3f',corr(CC_inv_tru__(:),CC_inv_rec__(:))));













